\section{SoC Event Generator}

\pulpissimo Events from peripherals and other sources can be forwarded to the
fabric controller, cluster or (back) to certain peripherals, though for
PULPissimo we don't have a cluster.

It is the SoC Event Generator's job to control which events are to be forwarded and where to.
There are three set of masks available to do this:
\begin{enumerate}[leftmargin=\widthof{[Peripheral Masks]}+\labelsep]
  \item[FC Masks] Control which events are to be forwarded to the fabric controller
  \item[Cluster Masks] Control which events are to be forwarded to the cluster (disabled)
  \item[Peripheral Masks] Control which events are to be forwarded to peripherals
\end{enumerate}



\subsection{SoC Event Generator registers}

\begin{table}[htbp]
  \small
\begin{tabularx}{\textwidth}{|l|l|l|l|l|l|X|}
  \hline
  \textbf{Name} & \textbf{Address}  & \textbf{Size} & \textbf{Type} & \textbf{Access} & \textbf{Default} & \textbf{Description} \\
  \hline
  SW\_EVENT & \texttt{0x1A106000} & 32 & Config & W      & \texttt{0x00000000} & SoC software events trigger register \\
  \hline
  FC\_MASK0 & \texttt{0x1A106004} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 0-31 dispatch mask to FC \\
  \hline
  FC\_MASK1 & \texttt{0x1A106008} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 32-63 dispatch mask to FC \\
  \hline
  FC\_MASK2 & \texttt{0x1A10600C} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 64-95 dispatch mask to FC \\
  \hline
  FC\_MASK3 & \texttt{0x1A106010} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 96-127 dispatch mask to FC \\
  \hline
  FC\_MASK4 & \texttt{0x1A106014} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 128-159 dispatch mask to FC \\
  \hline
  FC\_MASK5 & \texttt{0x1A106018} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 160-191 dispatch mask to FC \\
  \hline
  FC\_MASK6 & \texttt{0x1A10601C} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 191-223 dispatch mask to FC \\
  \hline
  FC\_MASK7 & \texttt{0x1A106020} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 224-255 dispatch mask to FC \\
  \hline

\end{tabularx}
\caption{SoC Event Generator register table part 1\label{tab:soc_eg_table0}}
\end{table}

\begin{table}[htbp]
  \small
\begin{tabularx}{\textwidth}{|l|l|l|l|l|l|X|}
  \hline
  \textbf{Name} & \textbf{Address}  & \textbf{Size} & \textbf{Type} & \textbf{Access} & \textbf{Default} & \textbf{Description} \\
  \hline
  PR\_MASK0 & \texttt{0x1A106044} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 0-31 dispatch mask to peripherals \\
  \hline
  PR\_MASK1 & \texttt{0x1A106048} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 32-63 dispatch mask to peripherals \\
  \hline
  PR\_MASK2 & \texttt{0x1A10604C} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 64-95 dispatch mask to peripherals \\
  \hline
  PR\_MASK3 & \texttt{0x1A106050} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 96-127 dispatch mask to peripherals \\
  \hline
  PR\_MASK4 & \texttt{0x1A106054} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 128-159 dispatch mask to peripherals \\
  \hline
  PR\_MASK5 & \texttt{0x1A106058} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 160-191 dispatch mask to peripherals \\
  \hline
  PR\_MASK6 & \texttt{0x1A10605C} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 191-223 dispatch mask to peripherals \\
  \hline
  PR\_MASK7 & \texttt{0x1A106060} & 32 & Config & R/W    & \texttt{0xFFFFFFFF} & Events 224-255 dispatch mask to peripherals \\
  \hline
  ERR0 & \texttt{0x1A106064} & 32 & Status & R    & \texttt{0x00000000} & Events 0-31 event queue overflow \\
  \hline
  ERR1 & \texttt{0x1A106068} & 32 & Status & R    & \texttt{0x00000000} & Events 32-63 event queue overflow \\
  \hline
  ERR2 & \texttt{0x1A10606C} & 32 & Status & R    & \texttt{0x00000000} & Events 64-95 event queue overflow \\
  \hline
  ERR3 & \texttt{0x1A106070} & 32 & Status & R    & \texttt{0x00000000} & Events 96-127 event queue overflow \\
  \hline
  ERR4 & \texttt{0x1A106074} & 32 & Status & R    & \texttt{0x00000000} & Events 128-159 event queue overflow \\
  \hline
  ERR5 & \texttt{0x1A106078} & 32 & Status & R    & \texttt{0x00000000} & Events 160-191 event queue overflow \\
  \hline
  ERR6 & \texttt{0x1A10607C} & 32 & Status & R    & \texttt{0x00000000} & Events 191-223 event queue overflow \\
  \hline
  ERR7 & \texttt{0x1A106080} & 32 & Status & R    & \texttt{0xFFFFFFFF} & Events 224-255 event queue overflow \\
  \hline
\end{tabularx}
\caption{SoC Event Generator register table part 2\label{tab:soc_eg_table1}}
\end{table}

\newpage

\regdoc{0x1A10\_6000}{0x0000\_0000}{SW\_EVENT}{
  \begin{bytefield}[endianness=big,bitwidth=2em]{16}
  \bitheader[lsb=16]{16-31} \\
  \bitbox{16}{\color{lightgray}\rule{\width}{\height}} \\[3ex]
  \bitheader{0-15} \\
  \bitbox{8}{\color{lightgray}\rule{\width}{\height}}\bitbox{8}{EVENT}
  \end{bytefield}
}{
  \regitem{Bit 7-0}{EVENT}{W}{Writing a one-hot value into EVENT triggers a SoC software event. 8 software events are available.}
}

\regdoc{0x1A10\_6004 + 0x4 * $X$}{0xFFFF\_FFFF}{FC\_MASK$X$, $X=0...7$}{
  \begin{bytefield}[endianness=big,bitwidth=2em]{16}
  \bitheader[lsb=16]{16-31} \\
  \bitbox{16}{FC\_MASK} \\[3ex]
  \bitheader{0-15} \\
  \bitbox{16}{FC\_MASK}
  \end{bytefield}
}{
  \regitem{Bit 31-0}{FC\_MASK}{R/W}{Event Mask to enable/disable event dispatch to FC interrupt controller.
    \begin{itemize}
      \item Setting $bit[i]$ to $0b1$ disables dispatching $event[32*X+i]$ to FC interrupt controller.
      \item Setting $bit[i]$ to $0b0$ enables dispatching $event[32*X+i]$ to FC interrupt controller.
    \end{itemize}
  }
}

\regdoc{0x1A10\_6044 + 0x4 * $X$}{0xFFFF\_FFFF}{PR\_MASK$X$, $X=0...7$}{
  \begin{bytefield}[endianness=big,bitwidth=2em]{16}
  \bitheader[lsb=16]{16-31} \\
  \bitbox{16}{PR\_MASK} \\[3ex]
  \bitheader{0-15} \\
  \bitbox{16}{PR\_MASK}
  \end{bytefield}
}{
  \regitem{Bit 31-0}{PR\_MASK}{R/W}{Event Mask to enable/disable event dispatch to peripherals.
    \begin{itemize}
      \item Setting $bit[i]$ to $0b1$ disables dispatching $event[32*X+i]$ to peripherals.
      \item Setting $bit[i]$ to $0b0$ enables dispatching $event[32*X+i]$ to peripherals.
    \end{itemize}
  }
}

\regdoc{0x1A10\_6064 + 0x4 * $X$}{0x0000\_0000}{ERR$X$, $X=0...7$}{
  \begin{bytefield}[endianness=big,bitwidth=2em]{16}
  \bitheader[lsb=16]{16-31} \\
  \bitbox{16}{ERR} \\[3ex]
  \bitheader{0-15} \\
  \bitbox{16}{ERR}
  \end{bytefield}
}{
  \regitem{Bit 31-0}{ERR}{R/W}{Event queue overflow. Clear after read. Reading
    $0b1$ at $ERR[i]$ means the event queue of event with id $32*X+i$
    overflowed.}
}